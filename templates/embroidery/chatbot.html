<!DOCTYPE html>
<html>
  <!-- Chatbot Button -->
  <div id="chatbot-button" onclick="toggleChat()">ðŸ’¬</div>

  <!-- Chatbot Window -->
  <div id="chatbot-container">
    <div id="chat-header">
      <h4>Chat with Us</h4>
      <button onclick="toggleChat()">X</button>
    </div>
    <div id="chatbox">
      <div class="bot-message">
        <span class="botText">Hello! How can I assist you?</span>
      </div>
    </div>
    <div id="typing-indicator" style="display: none">Bot is typing...</div>
    <div id="chat-input-container">
      <input
        id="chatInput"
        type="text"
        placeholder="Type a message..."
        onkeypress="sendMessage(event)"
      />
      <button onclick="startVoiceInput()">ðŸŽ¤</button>
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    function startVoiceInput() {
      var recognition = new (window.SpeechRecognition ||
        window.webkitSpeechRecognition)();
      recognition.lang = "en-US";

      recognition.onresult = function (event) {
        document.getElementById("chatInput").value =
          event.results[0][0].transcript;
        sendMessage(); // Auto-send message after speech input
      };

      recognition.start();
    }

    function sendMessage(event) {
      if (event && event.key !== "Enter") return;

      var userText = document.getElementById("chatInput").value;
      if (userText === "") return;

      var chatbox = document.getElementById("chatbox");

      // Display user message
      var userMessage = `<div class="user-message">${userText}</div>`;
      chatbox.innerHTML += userMessage;

      // Show typing indicator
      document.getElementById("typing-indicator").style.display = "block";

      // Send message to Django chatbot
      fetch("/chatbot/?message=" + encodeURIComponent(userText))
        .then((response) => response.json())
        .then((data) => {
          setTimeout(() => {
            document.getElementById("typing-indicator").style.display = "none";

            var botMessage = `<div class="bot-message">${data.response}</div>`;
            chatbox.innerHTML += botMessage;
            chatbox.scrollTop = chatbox.scrollHeight;

            // Convert bot response to speech
            var speech = new SpeechSynthesisUtterance(data.response);
            speech.lang = "en-US";
            window.speechSynthesis.speak(speech);
          }, 1000);
        });

      document.getElementById("chatInput").value = ""; // Clear input field
    }
  </script>

  <style>
    #chatbot-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      width: 50px;
      height: 50px;
      font-size: 24px;
      text-align: center;
      line-height: 50px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce {
      0%,
      100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
    }

    #chatbot-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 320px;
      background: white;
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
      display: none;
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    #chatbox {
      height: 250px;
      overflow-y: auto;
      padding: 10px;
      background: #f9f9f9;
    }
  </style>
</html>
